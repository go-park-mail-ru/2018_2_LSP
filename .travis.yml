language: go
go:
- 1.11
before_script:
- sudo apt-get install -qq sshpass
script:
# - go build server.go
after_success:
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker stop user && docker rm user
- sshpass -p $SSH_PASS scp -rp -o stricthostkeychecking=no * $SSH_USER@$SSH_HOST:~/server/
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker build -t user-server ~/server/
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker run -e "DB_HOST=postgres" -e "DB_USER=$DB_USER" -e "DB_PASS=$DB_PASS" -e "DB_DB=$DB_DB" -d --link postgres:postgres --publish 5050:8080 --name user -v ~/avatars:/go/src/github.com/go-park-mail-ru/2018_2_LSP/avatars --rm user-server

env:
  global:
  - secure: oYa1P2+flLk93cfey9qds8H7Sze0IEWV/dlXPLbX/B7uq0ABOSUncKup5qywgRqmByqnXNcUstD2u0RpDmOmD8TOtRu0xfe/mDtcujqcSJu+XFrj03c2UWrJs/K1hOHNgg3kyHk5ElGBcmkoQgPKSZ8v3H3Qe/F5fOZ9TXA8kuUdUCprW1XnHA/c7nCXzxUh1jarq6q0xbseqV8/+YwGd/slKvlGSVgBx6aRmP75pmJZB/ZZCdXwSLo7NS3pXp4isWzWZs2/oZ0arwDbZrTnW/RrkaaN0THyr3fbSEsvCwfdN4Oy00wQUOzUaHz3+4re9lbY91V4vcTvqQFztau7yGQDFwI7C7GlphYaGX/jfM8FW+RVCzXiAXiy1Pdgp5ax95VoKnb4EdixUu8ATkuGH+Wt0FnFRmQLotosHJ04q8JnUw9dZqDeFGUCF+1LKecd9kUXeYfBkNodHx4oL7JitrsasjVFfazNSk0fDh9Vu91JMSMeXwl9lc/N+dKohFaG/veupLlr7tH8xcAhUFYesnXIvrT7/Qg5yoRth0FDwQJFoHrv1qr0VPxzD1gRg/dzQLmR9s2iFoeja3Q5BmXITnCvbF1l8DmKhLPcsADAdE6C1GkUQ/2bU4+w+JRBmjQz4pF/KDuum/fUCWeTipUlvqZ6kpE4iPHUY41I5zU0LUI=
  - secure: QOEglj9LF05p2vObHimR0/Qw26P6bsAYJuFvFLFegrRN3WAAfsz9IF+x7PV8g2DvQXeF9/IqrOUoIkGIdpKQ/2FEaL8n9Kc0Of1vXFNPxGX2EWkkaF2K/RZt/o8AHRsZg37l53a3Mnlj+VLCoNHU0dbZxeQXV0pSb5e0bMIcq3OSH4IBRimo7wpbXVI1KlqVzoNnPfpJGH1PY31xnglFrAvm45dheA9nXQlWdXPFeiZFQ0bTCjSZjDiw5XphaYZIsyNWqDNlmAJoMecC/7ygS35jHLx+ySn2UpErJaKjP+Uh3tRid4o+DVH55ortDG662vIOiLVnUTWeXXLgbAJagAwQYl7RGk6znV+BfH5B0c9sfksE9Kw6WnO5kbtMGGgtORwBI54H/hWk9Jyn6jE5RA51rxUj4q5JNnFvycqZcEZFprUbnK6mAYowHMMYRd25RCs3FboZUcg41OB0zO6GOU5cKzbAXCK9kJjItXOtf7o/bqANP8pJQV3mI+11eDqYeJo0mHygK+vqKM5F7z91UIlfQ8UoHjWjZ2WL8AhW4sxB1zSAt49qMfv3mBcivuh3wKwq6d1NqLKlTLZrm0r8N+VzYVsX40zhPw3xKN03na+e9Xgjssk+N3nVqeHc6ADGvnhpRl/uJY3lfXE7xiK5JQ2t0QdKUIGwnVJyYuvj/Bc=
  - secure: Nf/tCYB1e9hysn4x5T+vHSAPKpqDjRYJcTtk7ovuaJsnZJ+9j4f4TbFj/4kIkuOJ1D6F/RpdsC/Qz015j4v5AwjXsgokdUWpIMrh6YMrNA8hiOm5gy9bDgabKoKacqgQHNv3+tcNzEZPQ/SbxwWN/NkgRdK0AwJzooy5aed/8nEixFvaO58elB2X3opRCkbm6IUtT4/XTge8xBbgP0YIR3YqeQ0h/SWdh80MJvNY5ZR5pNTZ84iyhtqq7HtoNHTsLq0QbmVTkUQaM+wbfOKB8/TL4SwxICTarWPm6oXoVF4+DZG7gk7KZ7O6W6k4skxOT8cZdQgG1dvBbUFAix1Ayf271Rjr7v8ih3FeUX9JfAot8XCLVEiHyvl6a0TEt7yLkrnZUNg6AKuKE57x5qGppTJmq+41LPSQc79xnjTTuCSohEU3Fu1+Tm3ZJl0QpqLyn80l+TzZIFS0Vt57lOviQCWvzZGY0CLunesR06T1gbMNctZDcZgKQPELP+cEoKhtr2vIRgNUmB4o8xA58ehGpa96LD0rwZ2u+/doWDQ4PqRHTddoBE3/LXeZO6ZImz3xqqjh8yaOqJGIdkOnGk1Xs5ldYgpvaamcrUdTDpxcYpdPJTw5BVCilgyR/fIBmzXTBMBOvZDEvinJw7kTf0iiViwsW7Me+KahkOSK/X4p2R0=
  - secure: LelaMxV90VkMZ8pwzewpx+TApq2gqAeQO/c960m2cU5HM+YcGH4L3FnTXtMEDP0ecxV/lMU0ct2TCy3uTcWNtCm1u/6T41+RkdBhukWzWas+7rZotOz9x7NCPZJ12K4d+ypntMq0xb0KN7YFhoEoq42qvnXwy7FYN0JLzYMO8sjKS44e2sa/TdKV/KfC9PLyvLtQRcvuZPougNI5tU28U6Yf7mt4OyVFcv9LOV0fRI6gmnowsw3qb50yg3T14NbLPVYsDZWTOUWXMgBeNt3pf9zAWkauVA2ui235yaQhqJoMx3/djDZN+iuR++XQfg+LmabonR99p/ZGNxgc7wtqvNkFQ4AD4KTNZhxCwMUFbx2+6vt8PgRi6ZkklkpMX3e/OjZPahVltxxRutLjyBTSMHDT97U88wFZ4VEcLtMOhd4aiSw8I5igRQOutYlai8DQVpaNvdj1iPMWnlOkXC/yX+lwW1Jtz3XaT9tr+6i1O/2qb5lEMY2zLWDLuRAUJ41TZekNISlF221LciRppq3DzNTI9N2Sal4kpWdytAXLcjGSBRZrGTFfmiSrozynfGkATXsjZTXXQgufS69JjPenf0xGSAdiORTwZ70ORZfU1qQl+wqLYHKW5AF/GPakAwqLz4klKGJVo/9CnMLFaGCuV0Z6257g4CJcPAT1HEJYTy0=
  - secure: Yx7K9TRcOo54rMXP8/zwkqTFuv7l8rDWEle3GrmskF+kfLE9r2bJJnrTFGMG4ZjQFmXhU+SX5tW1xbwJy8h/At3GeNWseJEvvy9y1QDXTYi7ZacsdCsn0kENZTN1O6ELR6KiflL7owlwqO6rTYYxk+BA5gnqc+Zxii/DCx5m+ZDGo12el7bEZvLMGKQHl6Tk9F8aRgOp4myzmtq8tF74HyEPGovcgclntVDUGYHfHlNCG1YS1O9KgTnmUmTimSGolT81hbuGS6pQiz12FUnfBcq+M/VEKiIXzW/EZDNw8jlS+B5aUDa0G4YgQzlBWwKfCUvEyoRRJyLaHixt/Bgmk2Xw/yD1/IAHEzw1vYLZE69/+vWr3K6MOUzsDck9Kst5pLBNHg2IMtPuKSORTPfN5Kv1Eb42P97C1sVgGKwAbGK/KY7vl4CRsuuEpDXDQx+naljCMpYhQeU8QCuvDz15PLvSzMTB5nbsDmSiGozEqLHI82STZ1v2qUJ7Fwzhr6oRI3UnuOaEWo61QerTTxu1YnFrXzRDgBvf6R1dJUl/JGV1lotfaJsYVPDeyOV/r68Osa+i/B1kLWncYduQIEHA85o3ahSJofPN+1NhwAInXAMCQ+4ywVv0HetVDoY9+jjRnjW+yw3JDl8Q3Kjw9Bbp8H1dG3DNQ+ufxzLSKl2hIIg=
  - secure: Bv5Ch59+AkEXxRMoltk2cgbVD+2NZGl0DKXqQaCjZsKeFzZeEIVmALXaak9Z20qAypCbScCcrUnQPrPtrsf9+y/dh3N5PS/dNMg0cZ7Sc7JDsXearDZ0cdUVq2Saa2D/w4wmw2Y+mB5Rp8v68tuSRXGHOY5nPeN8sfUL0MfLg4P+9kiBQ/+fO7nXTg17yDnWqAA43iMDLP1cB+Pp4ops03Ey1RHI53kfovq6VQ1C1WvwYJC7Zgpgqw2RJlCV62K35gf2XFYhzhDt4jPuC0+I3U8VkhoE1rRSGc3pEj0E3eVRWBqYhCfgRTLpnVDQxtBHhgwXkNXl9kqHHMqMKmYbYExoBjC3+9sg/EZRkRUq0KrOR4aw7fghiiAGU4W0OxXC3tb6uc7W1cjKGBPzdsdBof+aNMuOPwTK3gBjEVxx13vwdp52NM/WiDvK9VACHyDS4JJs8mOnDlgVTuBnIdd4ePS9D/RsepA7lC4+aZZoBy690+4natxew0u+umwZa0MEoC0IJdXDQlqmt+7vWa2Z1jgXmXv/emZMCZ14WLVqWrtSG+HMwYeGxj56nz7N8KecnyC9rvKT2IFj1lXhyVSaatI2apYRXoBGG7WiyMyZsW5QNeD0IwSwsI9+pSSgVv0SEjtDfHnCIiHqJNFY96D6wqhhBhQR3e4340GU+yLWUt4=
  - secure: qyj0snDaSPQFKc+6o/kEBoSmcVcZU9L/AlwgJ3kqQyl4fMVOo2Y1HdcxNQXqVC29hMnqdAgKHwMXTru4nOz5iBIFMjSgpiT2M/urS1PCcagpbVQjz7HQ5ioI8ojZqXL+lUzxyGvXF05FmKuMTGEs/Aml9WzT9vn/ehenmAzSA8hRntDkpuruFVX4IzvBdoxQ6azGZreSD/ld7xyDTOfnJWfKXYbBMiVHdyhZfDVZibe8S5/hTShpka0cj2uzzXAZ+jtJtiXaZ/JWuewaY5fnSQmaB2GcFWI0l+3lxTJAqKcc0BE9d+jcb3mhuqvrmRjGCxrPN+fuwRXe+CZwvsZBHVcTSD0i6zldXgV6Po/gWrCyYPN3TAYKPdztVW3dIYIPcG3TbG4tD/KAfmh77DXY1lnpk+Tqm7CnjBRRFnVeHgBt4gj/xv53aKlz0MGrDkve9ZySTWb8xabZJEOTpfKF9gbBFx8wOh62tphwjuwsDR8a6FsQi2mFSDtxyUVsruQEndcfo2GZCaOIuIbENHsZ9Anewe64FrBxqBt+V66m6kS+n9cayqH3Q5SGbuMlWXiGC01FRGZcIo1SLFNHE1FbI/sMzqJNAIKQsFhkO+ndh/rX9bYv0gNtkejxa0tZJbf2OYfZjRsD9DYAqXu3kO+fabAdzXNNSRDaHES516pgeb0=